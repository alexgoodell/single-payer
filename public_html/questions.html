<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Google webfonts -->
    <link href="https://fonts.googleapis.com/css?family=Amiri|Trocchi" rel="stylesheet">

    <style>


    h1 { 
      font-family: 'Trocchi', serif; 
    }
    body { 
        font-family: 'Amiri', serif; 
    }
    .bg-people {
      /*background: url("{{ url_for('static', filename = 'imgs/people.svg') }}") bottom center;*/
      /*background-repeat: no-repeat;*/
      /*background-size: 100%;*/
      width: 100%;
      /*height: 600px;*/

    }
    .bg-blue {
      background: #C1D8EA;
      height: 300px;
    }
    .bg-dark-blue {
      background: #568FA2;
      height: 400px;
    }
    .footer li {
      background: none;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      color: white
    }
    #octocat_img {
      max-width: 40px;
    }

    #octoholder {
      text-align: right
    }

    #maincol {
      text-align: center;
      padding-top: 50px;
    }


    </style>


    <title>Single payer cost</title>
  </head>
  <body>
    

        <div id="surveyElement"></div>
        <div id="surveyResult"></div>
        <!-- <div id="resultHere"></div> -->







    <!-- survey js -->
    <!-- <script src="https://unpkg.com/jquery"></script> -->
    <!-- <script src="https://surveyjs.azureedge.net/1.0.61/survey.jquery.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://surveyjs.azureedge.net/1.0.61/survey.jquery.min.js"></script>
    <link href="static/styles/survey.css" type="text/css" rel="stylesheet"/>

    <script type="text/javascript"> 
      

      Survey
          .StylesManager
          .applyTheme("bootstrap");

      var json = {
 title: "Single payer",
 completedHtml: "Please wait while your results are loaded.",
 loadingHtml: "Loading....",
 pages: [
  {
   name: "p_premiums",
   elements: [
    {
     type: "dropdown",
     name: "q_premiums",
     title: "How much did your household spend last year on health insurance premiums? ",
     description: "For example, if insured from work report your premium contributions, or if from the ACA exchange report the portion not covered by an ACA subsidy. Please report the total for all insurance.",
     choices: [
      {
       value: 250,
       text: "$0 - $500"
      },
      {
       value: 750.5,
       text: "$501 - $1000"
      },
      {
       value: 1250.5,
       text: "$1001 - $1500"
      },
      {
       value: 1750.5,
       text: "$1501 - $2000"
      },
      {
       value: 2250.5,
       text: "$2001 - $2500"
      },
      {
       value: 2750.5,
       text: "$2501 - $3000"
      },
      {
       value: 3250.5,
       text: "$3001 - $3500"
      },
      {
       value: 3750.5,
       text: "$3501 - $4000"
      },
      {
       value: 4250.5,
       text: "$4001 - $4500"
      },
      {
       value: 4750.5,
       text: "$4501 - $5000"
      },
      {
       value: 5250.5,
       text: "$5001 - $5500"
      },
      {
       value: 5750.5,
       text: "$5501 - $6000"
      },
      {
       value: 6250.5,
       text: "$6001 - $6500"
      },
      {
       value: 6750.5,
       text: "$6501 - $7000"
      },
      {
       value: 7250.5,
       text: "$7001 - $7500"
      },
      {
       value: 7750.5,
       text: "$7501 - $8000"
      },
      {
       value: 8250.5,
       text: "$8001 - $8500"
      },
      {
       value: 8750.5,
       text: "$8501 - $9000"
      },
      {
       value: 9250.5,
       text: "$9001 - $9500"
      },
      {
       value: 9750.5,
       text: "$9501 - $10000"
      },
      {
       value: 10250.5,
       text: "$10001 - $10500"
      },
      {
       value: 10750.5,
       text: "$10501 - $11000"
      },
      {
       value: 11250.5,
       text: "$11001 - $11500"
      },
      {
       value: 11750.5,
       text: "$11501 - $12000"
      },
      {
       value: 12250.5,
       text: "$12001 - $12500"
      },
      {
       value: 12750.5,
       text: "$12501 - $13000"
      },
      {
       value: 13250.5,
       text: "$13001 - $13500"
      },
      {
       value: 13750.5,
       text: "$13501 - $14000"
      },
      {
       value: 14250.5,
       text: "$14001 - $14500"
      },
      {
       value: 14750.5,
       text: "$14501 - $15000"
      },
      {
       value: 15250.5,
       text: "$15001 - $15500"
      },
      {
       value: 15750.5,
       text: "$15501 - $16000"
      },
      {
       value: 16250.5,
       text: "$16001 - $16500"
      },
      {
       value: 16750.5,
       text: "$16501 - $17000"
      },
      {
       value: 17250.5,
       text: "$17001 - $17500"
      },
      {
       value: 17750.5,
       text: "$17501 - $18000"
      },
      {
       value: 18250.5,
       text: "$18001 - $18500"
      },
      {
       value: 18750.5,
       text: "$18501 - $19000"
      },
      {
       value: 19250.5,
       text: "$19001 - $19500"
      },
      {
       value: 19750.5,
       text: "$19501 - $20000"
      }
     ]
    }
   ]
  },
  {
   name: "p_oop",
   elements: [
    {
     type: "dropdown",
     name: "q_oop",
     title: "What were your out-of-pocket expenditures, for deductibles, copayments, and uncovered services? ",
     description: "Please think about primary care and specialist office visits, hospitalization / surgery, counseling / therapy, maternity / infertility treatments, chiropractor / acupuncture, and all prescription and over-the-counter medicines.",
     choices: [
      {
       value: 250,
       text: "$0 - $500"
      },
      {
       value: 750.5,
       text: "$501 - $1000"
      },
      {
       value: 1250.5,
       text: "$1001 - $1500"
      },
      {
       value: 1750.5,
       text: "$1501 - $2000"
      },
      {
       value: 2250.5,
       text: "$2001 - $2500"
      },
      {
       value: 2750.5,
       text: "$2501 - $3000"
      },
      {
       value: 3250.5,
       text: "$3001 - $3500"
      },
      {
       value: 3750.5,
       text: "$3501 - $4000"
      },
      {
       value: 4250.5,
       text: "$4001 - $4500"
      },
      {
       value: 4750.5,
       text: "$4501 - $5000"
      },
      {
       value: 5250.5,
       text: "$5001 - $5500"
      },
      {
       value: 5750.5,
       text: "$5501 - $6000"
      },
      {
       value: 6250.5,
       text: "$6001 - $6500"
      },
      {
       value: 6750.5,
       text: "$6501 - $7000"
      },
      {
       value: 7250.5,
       text: "$7001 - $7500"
      },
      {
       value: 7750.5,
       text: "$7501 - $8000"
      },
      {
       value: 8250.5,
       text: "$8001 - $8500"
      },
      {
       value: 8750.5,
       text: "$8501 - $9000"
      },
      {
       value: 9250.5,
       text: "$9001 - $9500"
      },
      {
       value: 9750.5,
       text: "$9501 - $10000"
      },
      {
       value: 10250.5,
       text: "$10001 - $10500"
      },
      {
       value: 10750.5,
       text: "$10501 - $11000"
      },
      {
       value: 11250.5,
       text: "$11001 - $11500"
      },
      {
       value: 11750.5,
       text: "$11501 - $12000"
      },
      {
       value: 12250.5,
       text: "$12001 - $12500"
      },
      {
       value: 12750.5,
       text: "$12501 - $13000"
      },
      {
       value: 13250.5,
       text: "$13001 - $13500"
      },
      {
       value: 13750.5,
       text: "$13501 - $14000"
      },
      {
       value: 14250.5,
       text: "$14001 - $14500"
      },
      {
       value: 14750.5,
       text: "$14501 - $15000"
      },
      {
       value: 15250.5,
       text: "$15001 - $15500"
      },
      {
       value: 15750.5,
       text: "$15501 - $16000"
      },
      {
       value: 16250.5,
       text: "$16001 - $16500"
      },
      {
       value: 16750.5,
       text: "$16501 - $17000"
      },
      {
       value: 17250.5,
       text: "$17001 - $17500"
      },
      {
       value: 17750.5,
       text: "$17501 - $18000"
      },
      {
       value: 18250.5,
       text: "$18001 - $18500"
      },
      {
       value: 18750.5,
       text: "$18501 - $19000"
      },
      {
       value: 19250.5,
       text: "$19001 - $19500"
      },
      {
       value: 19750.5,
       text: "$19501 - $20000"
      }
     ]
    }
   ]
  },
  {
   name: "act-hh",
   elements: [
    {
     type: "text",
     name: "q_num_hh_mem",
     title: "How many people are in your household?",
     inputType: "number",
     placeHolder: "1"
    }
   ]
  },
  {
   name: "p_income",
   elements: [
    {
     type: "dropdown",
     name: "q_income",
     title: "In order to estimate your costs under single payer, we need to know your approximate household income.",
     choices: [
      {
       value: 25000,
       text: "$25,000 or less"
      },
      {
       value: 37500,
       text: "$25,001 - $50,000"
      },
      {
       value: 62500,
       text: "$ 50,001 - $75,000"
      },
      {
       value: 87500,
       text: "$75,001 - $100,000"
      },
      {
       value: 125000,
       text: "$100,001 - $150,000"
      },
      {
       value: 175000,
       text: "$150,001 - $200,000"
      },
      {
       value: 200000,
       text: "$200,001 - $300,000"
      },
      {
       value: 400000,
       text: "$300,001 - $500,000"
      },
      {
       value: 750000,
       text: "$500,001 - $1,000,000"
      },
      {
       value: 2000000,
       text: "More than $1,000,000"
      }
     ],
     otherText: "Or enter directly:"
    }
   ]
  },
  {
   name: "p_email",
   elements: [
    {
     type: "text",
     name: "q_email",
     title: "If you’d like us to contact you about single payer, please provide your email address.",
     validators: [
      {
       type: "email"
      }
     ]
    }
   ]
  }
 ],
 showTitle: false,
 showQuestionNumbers: "off",
 showProgressBar: "bottom",
 startSurveyText: "Start",
 pagePrevText: "<",
 pageNextText: ">",
 completeText: "Calculate"
}

      window.survey = new Survey.Model(json);

 function bearerFun() {
    // recieve a bearer token from the server
      var bearerRequest = new XMLHttpRequest();
      var tolkenUrl = 'https://login.microsoftonline.com/singlepayercost.onmicrosoft.com/oauth2/v2.0/token';
      var params = 'client_id=a47c5bb1-d6c5-4b15-ad04-4965a6a52200&scope=https://graph.microsoft.com/.default&client_secret=Yid05ISF3R3vI1loFlLzTE6RLZTHUTT40cSpJcgLkso=&grant_type=client_credentials';
      var bearerID;
      bearerRequest.open('POST', tolkenUrl, true);
      bearerRequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      bearerRequest.setRequestHeader('Access-Control-Allow_Origin', '*');
      var parsedResponse;
      bearerRequest.onreadystatechange = function(){
        if (bearerRequest.readyState == 4 && bearerRequest.status == 200) {
          parsedResponse = JSON.parse(bearerRequest.responseText);
          bearerID = parsedResponse["access_token"]
          console.log('beearer ID success');
          sessionFun(bearerID);
        }
        console.log(bearerID);
      }
      bearerRequest.send(params);
      
    }
  function sessionFun(bearerID) {
      // create a session, record session id
      var sessionRequest = new XMLHttpRequest(); 
      var responseURL = "https://graph.microsoft.com/v1.0/users/a01ab9eb-36de-4ebc-9889-3eb61d16d0e8/drives/b!8BpoJu__qEGSPkgzdPS-tpKUfASPeq9KuGIiQ7kUjgFvDlgFQHDHTYFuK27A0xlp/items/01X34IAM7MSEX2BK2PTJELELKUX4QPSWXA/workbook/createSession";
      sessionRequest.open('POST', responseURL, true);
      console.log(bearerID);
      sessionRequest.setRequestHeader('Authorization', 'Bearer '+ bearerID);
      sessionRequest.setRequestHeader('Content-Type', 'application/json');
      sessionRequest.setRequestHeader('scope', 'Files.ReadWrite.All');
      var persist = '{"persistChanges": false}';
      sessionRequest.onreadystatechange = function() {
        console.log('session entered...');
        console.log('readystate:'+sessionRequest.readyState);
        console.log('status'+sessionRequest.status);

        if (sessionRequest.readyState == 4 && sessionRequest.status == 201) {
          parsedResponse = JSON.parse(sessionRequest.responseText);
          var sessionID = parsedResponse["id"];
          console.log('session created');
          inputFun(sessionID,bearerID,survey);
        }
      }
      sessionRequest.send(persist);
      
    }
  function inputFun(sessionID,bearerID,survey) {
      // update input values on session instance 
      var inputRequest = new XMLHttpRequest(); 
      var inputURL = "https://graph.microsoft.com/v1.0/users/a01ab9eb-36de-4ebc-9889-3eb61d16d0e8/drives/b!8BpoJu__qEGSPkgzdPS-tpKUfASPeq9KuGIiQ7kUjgFvDlgFQHDHTYFuK27A0xlp/items/01X34IAM7MSEX2BK2PTJELELKUX4QPSWXA/workbook/worksheets('IO')/range(address='C3:C6')";
      var data = '{"values": [['+survey.getValue('q_income')+'], ['+survey.getValue('q_num_hh_mem')+'], ['+survey.getValue('q_premiums')+'], ['+survey.getValue('q_oop')+']]}';
      console.log(data);
      inputRequest.open('PATCH', inputURL, false);
      inputRequest.setRequestHeader('Authorization', 'Bearer '+bearerID);
      inputRequest.setRequestHeader('Content-Type', 'application/json');
      inputRequest.setRequestHeader('scope', 'Files.ReadWrite.All');
      inputRequest.setRequestHeader('workbook-session-id', sessionID);
      inputRequest.onreadystatechange = function() {
        if (inputRequest.readyState == 4 && inputRequest.status == 200) {
          console.log('input completed');
          receptFun(sessionID,bearerID);
        }
      }
      inputRequest.send(data);
          }
  function receptFun(sessionID,bearerID) {
      // recieve results
      var dataResponse = new XMLHttpRequest(); 
      var dataURL = "https://graph.microsoft.com/v1.0/users/a01ab9eb-36de-4ebc-9889-3eb61d16d0e8/drives/b!8BpoJu__qEGSPkgzdPS-tpKUfASPeq9KuGIiQ7kUjgFvDlgFQHDHTYFuK27A0xlp/items/01X34IAM7MSEX2BK2PTJELELKUX4QPSWXA/workbook/worksheets('IO')/range(address='C10:C13')";
      dataResponse.open('GET', dataURL, true);
      dataResponse.setRequestHeader('Authorization', 'Bearer ' + bearerID);
      dataResponse.setRequestHeader('Content-Type', 'application/json');
      dataResponse.setRequestHeader('scope', 'Files.ReadWrite.All');
      dataResponse.setRequestHeader('workbook-session-id', sessionID);
      dataResponse.onreadystatechange = function() {
        if (dataResponse.readyState == 4 && dataResponse.status == 200) {
          parsedResponse = JSON.parse(dataResponse.responseText); 
          var cost = parsedResponse["text"][3];
          console.log(); 
          document.getElementById("surveyElement").innerHTML = "<h2>You currently spend: " + parsedResponse["text"][0] + "</h2>";
          document.getElementById("surveyElement").innerHTML += "<h2>Added taxes under single payer:  " + parsedResponse["text"][1] + "</h2>";
          document.getElementById("surveyElement").innerHTML += "<h2>Total single payer cost:  " + parsedResponse["text"][2] + "</h2>";
          if (cost[0][0] == "-") {
          document.getElementById("surveyElement").innerHTML += "<h1>You would spend: " + cost[0].slice(1) + " more</h1>";
          }
          else {
          	document.getElementById("surveyElement").innerHTML += "<h1>You would save: " + cost + "</h1>";
          }
        }
      }
      dataResponse.send(null);
  }   

      survey
          .onUpdateQuestionCssClasses
          .add(function (survey, options) {
              var classes = options.cssClasses

              classes.root = "sq-root";
              classes.title = "sq-title";
              classes.item = "sq-item";
              classes.label = "sq-label";
              classes.progress = "sq-progress";
              classes.progressBar = "sq-progress-bar";

              if (options.question.isRequired) {
                  classes.title = "sq-title sq-title-required";
                  classes.root = "sq-root sq-root-required";
              }

              if (options.question.getType() === "checkbox") {
                  classes.root = "sq-root sq-root-cb";
              }
          });

      $("#surveyElement").Survey({model: survey, onComplete:bearerFun});


    </script>

  </body>
</html>